const translations = {
    ru: {
        // Общие элементы
        appTitle: "Список дел",
        login: "Войти",
        register: "Регистрация",
        logout: "Выйти",
        username: "Имя пользователя",
        email: "Электронная почта",
        password: "Пароль",
        confirmPassword: "Подтвердите пароль",
        forgotPassword: "Забыли пароль?",
        
        // Задачи
        addTask: "Добавить задачу",
        taskPlaceholder: "Введите новую задачу...",
        noTasks: "Нет задач",
        markCompleted: "Отметить выполненной",
        markIncomplete: "Отметить невыполненной",
        deleteTask: "Удалить",
        
        // Дедлайны
        noDeadline: "Без дедлайна",
        overdue: "Просрочено",
        today: "Сегодня",
        tomorrow: "Завтра",
        inDays: "Через",
        until: "До",
        days: "дн.",
        author: "Автор",
        
        // Сообщения
        taskAdded: "Задача добавлена",
        taskUpdated: "Задача обновлена",
        taskDeleted: "Задача удалена",
        loginSuccess: "Успешный вход",
        loginError: "Ошибка входа",
        registerSuccess: "Регистрация успешна",
        registerError: "Ошибка регистрации",
        logoutSuccess: "Вы вышли из системы",
        
        // Ошибки аутентификации
        invalidCredentials: "Неверные учетные данные",
        accountBlocked: "Аккаунт заблокирован",
        userNotFound: "Пользователь не найден",
        emailRequired: "Требуется email",
        usernameRequired: "Требуется имя пользователя",
        passwordRequired: "Требуется пароль",
        emailSent: "Письмо отправлено на почту",
        passwordResetSent: "Ссылка для сброса пароля отправлена",
        passwordResetSuccess: "Пароль успешно сброшен",
        invalidToken: "Неверный или истекший токен",
        
        // Валидация
        fieldRequired: "Поле обязательно для заполнения",
        invalidEmail: "Неверный формат email",
        passwordTooShort: "Пароль должен содержать минимум 6 символов",
        passwordsDoNotMatch: "Пароли не совпадают",
        
        // Языки
        language: "Язык",
        russian: "Русский",
        english: "English",
        mongolian: "Монгол",
        
        // Дополнительные переводы
        sendResetLink: "Отправить ссылку",
        cancel: "Отмена",
        edit: "Редактировать",
        save: "Сохранить",
        
        // Командные проекты
        myTasks: "Мои задачи",
        teamProjects: "Командные проекты",
        myTeamProjects: "Мои командные проекты",
        createProject: "Создать проект",
        joinProject: "Присоединиться",
        projectName: "Название проекта",
        projectCode: "Код проекта",
        create: "Создать",
        join: "Присоединиться",
        back: "Назад",
        noProjects: "У вас пока нет командных проектов",
        projectCreated: "Проект создан! Код: {code}",
        projectJoined: "Вы присоединились к проекту",
        invalidCode: "Неверный код проекта",
        open: "Открыть",
        code: "Код",
        deadline: "Дедлайн",
        overdue: "Просрочено",
        completedOnTime: "Выполнено вовремя"
    },


    en: {
        // General elements
        appTitle: "ToDo List",
        login: "Login",
        register: "Register",
        logout: "Logout",
        username: "Username",
        email: "Email",
        password: "Password",
        confirmPassword: "Confirm Password",
        forgotPassword: "Forgot password?",
        
        // Tasks
        addTask: "Add Task",
        taskPlaceholder: "Enter new task...",
        noTasks: "No tasks",
        markCompleted: "Mark as completed",
        markIncomplete: "Mark as incomplete",
        deleteTask: "Delete",
        
        // Deadlines
        noDeadline: "No deadline",
        overdue: "Overdue",
        today: "Today",
        tomorrow: "Tomorrow",
        inDays: "In",
        until: "Until",
        days: "days",
        author: "Author",
        
        // Messages
        taskAdded: "Task added",
        taskUpdated: "Task updated",
        taskDeleted: "Task deleted",
        loginSuccess: "Login successful",
        loginError: "Login error",
        registerSuccess: "Registration successful",
        registerError: "Registration error",
        logoutSuccess: "Logged out successfully",
        
        // Authentication errors
        invalidCredentials: "Invalid credentials",
        accountBlocked: "Account blocked",
        userNotFound: "User not found",
        emailRequired: "Email required",
        usernameRequired: "Username required",
        passwordRequired: "Password required",
        emailSent: "Email sent",
        passwordResetSent: "Password reset link sent",
        passwordResetSuccess: "Password reset successfully",
        invalidToken: "Invalid or expired token",
        
        // Validation
        fieldRequired: "Field is required",
        invalidEmail: "Invalid email format",
        passwordTooShort: "Password must be at least 6 characters",
        passwordsDoNotMatch: "Passwords do not match",
        
        // Languages
        language: "Language",
        russian: "Русский",
        english: "English",
        mongolian: "Монгол",
        
        // Additional translations
        sendResetLink: "Send Reset Link",
        cancel: "Cancel",
        edit: "Edit",
        save: "Save",
        
        // Team projects
        myTasks: "My Tasks",
        teamProjects: "Team Projects",
        myTeamProjects: "My Team Projects",
        createProject: "Create Project",
        joinProject: "Join Project",
        projectName: "Project Name",
        projectCode: "Project Code",
        create: "Create",
        join: "Join",
        back: "Back",
        noProjects: "You don't have any team projects yet",
        projectCreated: "Project created! Code: {code}",
        projectJoined: "You joined the project",
        invalidCode: "Invalid project code",
        open: "Open",
        code: "Code",
        deadline: "Deadline",
        overdue: "Overdue",
        completedOnTime: "Completed on time"
    },
    
    mn: {
        appTitle: "Хийх ажлын жагсаалт",
        login: "Нэвтрэх",
        register: "Бүртгүүлэх",
        logout: "Гарах",
        username: "Хэрэглэгчийн нэр",
        email: "И-мэйл",
        password: "Нууц үг",
        confirmPassword: "Нууц үгээ баталгаажуулах",
        forgotPassword: "Нууц үгээ мартсан уу?",
        
        addTask: "Ажил нэмэх",
        taskPlaceholder: "Шинэ ажил оруулах...",
        noTasks: "Ажил байхгүй",
        
        // Дедлайны
        noDeadline: "Дуусах хугацаа байхгүй",
        overdue: "Хугацаа хэтэрсэн",
        today: "Өнөөдөр",
        tomorrow: "Маргааш",
        inDays: "Хэдэн хоногийн дараа",
        until: "Хүртэл",
        days: "хоног",
        author: "Зохиогч",
        markCompleted: "Дууссан гэж тэмдэглэх",
        markIncomplete: "Дуусаагүй гэж тэмдэглэх",
        deleteTask: "Устгах",
        
        taskAdded: "Ажил нэмэгдлээ",
        taskUpdated: "Ажил шинэчлэгдлээ",
        taskDeleted: "Ажил устгагдлаа",
        loginSuccess: "Амжилттай нэвтэрлээ",
        loginError: "Нэвтрэх алдаа",
        registerSuccess: "Амжилттай бүртгүүллээ",
        registerError: "Бүртгүүлэх алдаа",
        logoutSuccess: "Амжилттай гарлаа",
        
        invalidCredentials: "Буруу нэвтрэх мэдээлэл",
        accountBlocked: "Хэрэглэгчийн эрх хаагдсан",
        userNotFound: "Хэрэглэгч олдсонгүй",
        emailRequired: "И-мэйл шаардлагатай",
        usernameRequired: "Хэрэглэгчийн нэр шаардлагатай",
        passwordRequired: "Нууц үг шаардлагатай",
        emailSent: "И-мэйл илгээгдлээ",
        passwordResetSent: "Нууц үг сэргээх холбоос илгээгдлээ",
        passwordResetSuccess: "Нууц үг амжилттай сэргээгдлээ",
        invalidToken: "Буруу эсвэл хугацаа дууссан токен",
        
        fieldRequired: "Талбар заавал бөглөх ёстой",
        invalidEmail: "Буруу и-мэйл формат",
        passwordTooShort: "Нууц үг дор хаяж 6 тэмдэгт байх ёстой",
        passwordsDoNotMatch: "Нууц үгүүд таарахгүй байна",
        
        language: "Хэл",
        russian: "Русский",
        english: "English",
        mongolian: "Монгол",
        
        sendResetLink: "Сэргээх холбоос илгээх",
        cancel: "Цуцлах",
        edit: "Засварлах",
        save: "Хадгалах",
        
        // Багийн төслүүд
        myTasks: "Миний ажлууд",
        teamProjects: "Багийн төслүүд",
        myTeamProjects: "Миний багийн төслүүд",
        createProject: "Төсөл үүсгэх",
        joinProject: "Нэгдэх",
        projectName: "Төслийн нэр",
        projectCode: "Төслийн код",
        create: "Үүсгэх",
        join: "Нэгдэх",
        back: "Буцах",
        noProjects: "Танд одоогоор багийн төсөл байхгүй байна",
        projectCreated: "Төсөл үүсгэгдлээ! Код: {code}",
        projectJoined: "Та төсөлд нэгдлээ",
        invalidCode: "Буруу төслийн код",
        open: "Нээх",
        code: "Код",
        deadline: "Дуусах хугацаа",
        overdue: "Хугацаа хэтэрсэн",
        completedOnTime: "Цагт дууссан"
    }
};

let currentLanguage = localStorage.getItem('language') || 'ru';

function t(key) {
    return translations[currentLanguage][key] || key;
}


function changeLanguage(lang) {
    if (translations[lang]) {
        currentLanguage = lang;
        localStorage.setItem('language', lang);
        updateUI();
        
        // Обновляем тексты дедлайнов и авторов
        if (typeof updateDeadlineTexts === 'function') {
            updateDeadlineTexts();
        }
        
        // Перезагружаем задачи для обновления переводов
        if (typeof loadTasks === 'function') {
            loadTasks();
        }
        
        // Перезагружаем командные задачи если они открыты
        if (typeof currentProject !== 'undefined' && currentProject && typeof loadTeamTasks === 'function') {
            loadTeamTasks(currentProject.id);
        }
    }
}

function updateUI() {
    // Обновляем все элементы с data-i18n атрибутом
    document.querySelectorAll('[data-i18n]').forEach(element => {
        const key = element.getAttribute('data-i18n');
        const translation = t(key);
        
        if (element.tagName === 'INPUT' && (element.type === 'text' || element.type === 'email' || element.type === 'password')) {
            element.placeholder = translation;
        } else {
            element.textContent = translation;
        }
    });
    
    document.querySelectorAll('.lang-btn').forEach(btn => {
        btn.classList.remove('active');
        if (btn.getAttribute('data-lang') === currentLanguage) {
            btn.classList.add('active');
        }
    });
    
    document.title = t('appTitle');
    
    updateTaskButtons();
}

// Функция для обновления кнопок задач
function updateTaskButtons() {
    // Обновляем кнопки в личных задачах
    const taskList = document.getElementById('task-list');
    if (taskList) {
        taskList.querySelectorAll('button').forEach(button => {
            updateButtonText(button);
        });
    }
    
    // Обновляем кнопки в командных задачах
    const teamTaskList = document.getElementById('team-task-list');
    if (teamTaskList) {
        teamTaskList.querySelectorAll('button').forEach(button => {
            updateButtonText(button);
        });
    }
    
    // Обновляем кнопки в списке командных проектов
    const teamProjectsList = document.getElementById('team-projects-list');
    if (teamProjectsList) {
        teamProjectsList.querySelectorAll('button').forEach(button => {
            updateButtonText(button);
        });
    }
}

// Делаем функцию глобальной
window.updateTaskButtons = updateTaskButtons;

// Вспомогательная функция для обновления текста кнопки
function updateButtonText(button) {
    const text = button.textContent;
    
    if (text.includes('Отметить выполненной') || text.includes('Mark as completed') || text.includes('Дууссан гэж тэмдэглэх')) {
        button.textContent = t('markCompleted');
    } else if (text.includes('Отметить невыполненной') || text.includes('Mark as incomplete') || text.includes('Дуусаагүй гэж тэмдэглэх')) {
        button.textContent = t('markIncomplete');
    } else if (text.includes('Редактировать') || text.includes('Edit') || text.includes('Засварлах')) {
        button.textContent = t('edit');
    } else if (text.includes('Сохранить') || text.includes('Save') || text.includes('Хадгалах')) {
        button.textContent = t('save');
    } else if (text.includes('Удалить') || text.includes('Delete') || text.includes('Устгах')) {
        button.textContent = t('deleteTask');
    } else if (text.includes('Открыть') || text.includes('Open') || text.includes('Нээх')) {
        button.textContent = t('open');
    } else if (text.includes('Отмена') || text.includes('Cancel') || text.includes('Цуцлах')) {
        button.textContent = t('cancel');
    }
}


document.addEventListener('DOMContentLoaded', function() {
    updateUI();
});
